<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.eclipse.org/gemini/blueprint/schema/blueprint http://www.eclipse.org/gemini/blueprint/schema/blueprint/gemini-blueprint.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-3.0.xsd">

    <!--OSGi Service-->
    <bean class="org.jahia.modules.databaseConnector.connection.DatabaseConnectorManager" id="databaseConnectorManager" factory-method="getInstance">
        <property name="dslExecutor" ref="dslExecutor"/>
        <property name="settingsBean" ref="settingsBean"/>
        <property name="jcrTemplate" ref="jcrTemplate" />
        <property name="renderService" ref="RenderService"/>
        <property name="templateManagerService" ref="JahiaTemplateManagerService"/>
        <property name="dslHandlerMap">
            <map key-type="java.lang.String" value-type="org.jahia.modules.databaseConnector.dsl.DSLHandler">
                <entry key="importConnection" value-ref="dcConnectionImportHandler"/>
                <entry key="directive" value-ref="directiveHandler"/>
                <entry key="service" value-ref="serviceHandler"/>
            </map>
        </property>
    </bean>

    <bean class="org.jahia.modules.databaseConnector.connection.RegistryListener" id="registryListener">
        <property name="settingsBean" ref="settingsBean"/>
        <property name="jcrTemplate" ref="jcrTemplate" />
    </bean>

    <lang:groovy id="dslExecutor" script-source="classpath:org/jahia/modules/databaseConnector/dsl/DSLExecutorImpl.groovy"></lang:groovy>
    <lang:groovy id="dcConnectionImportHandler" script-source="classpath:org/jahia/modules/databaseConnector/dsl/ConnectionImportHandler.groovy">
        <lang:property name="databaseConnectorManager" ref="databaseConnectorManager"/>
    </lang:groovy>
    <lang:groovy id="directiveHandler" script-source="classpath:org/jahia/modules/databaseConnector/dsl/DirectiveHandler.groovy">
        <lang:property name="jcrTemplate" ref="jcrTemplate"/>
    </lang:groovy>
    <lang:groovy id="serviceHandler" script-source="classpath:org/jahia/modules/databaseConnector/dsl/ServiceHandler.groovy">
        <lang:property name="jcrTemplate" ref="jcrTemplate"/>
    </lang:groovy>
</beans>